<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Hugo 0.18.1" />


<title>SAS Algorithmically(1): Newton-Raphson method - Jiangtang Hu | 胡江堂</title>
<meta property="og:title" content="SAS Algorithmically(1): Newton-Raphson method - Jiangtang Hu | 胡江堂">



  







<link rel="stylesheet" href="../../../../css/fonts.css" media="all">
<link rel="stylesheet" href="../../../../css/main.css" media="all">



  </head>
  <body>
    <div class="wrapper">
      <header class="header">
        <nav class="nav">
  <a href="../../../../" class="nav-logo">
    <img src="../../../../images/logo.png"
         width="50"
         height="50"
         alt="Logo">
  </a>

  <ul class="nav-links">
    
    <li><a href="../../../../about/">About</a></li>
    
    <li><a href="https://github.com/jiangtang">GitHub</a></li>
    
    <li><a href="https://twitter.com/JiangtangHu">Twitter</a></li>
    
  </ul>
</nav>

      </header>


<main class="content" role="main">

  <article class="article">
    
    <span class="article-duration">2 min read</span>
    

    <h1 class="article-title">SAS Algorithmically(1): Newton-Raphson method</h1>

    
    <span class="article-date">2010/10/21</span>
    

    <div class="article-content">
      <p>A good reference for the basic algorithms of Newton-Raphson method to calculate the square root of a number, <em>see</em></p>

<blockquote>
<p><a href="http://mathforum.org/library/drmath/view/52644.html">http://mathforum.org/library/drmath/view/52644.html</a></p>
</blockquote>

<p>And the SAS codes(self-explanatory):</p>

<blockquote>
<p><font face="Courier New">data root; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; /<em>question: find the square root of 4</em>/ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; x=4;&#160; </font></p>

<p><font face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; /<em>first choose a rough approximation of sqrt(4); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; actually, you can start with any numbers</em>/ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; y0=1;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </font></p>

<p><font face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; count=0;/<em>init count number</em>/ </font></p>

<p><font face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; do until (w<1e-8); /*set a small tolerance error*/ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; count=count+1;&#160;&#160; /<em>accumulate count number</em>/ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; y=(y0+x/y0)/2;&#160;&#160; /<em>Newton&#8217;s formula</em>/ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; w=abs(y-y0); /<em>if close, exit;</em>/ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; y0=y;&#160;&#160;&#160;&#160;&#160;&#160;&#160; /* otherwise, keep the new one*/ <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; end; </font></p>

<p><font face="Courier New">&#160;&#160;&#160;&#160;&#160;&#160;&#160; output; <br />run;</font></p>
</blockquote>

<p>The outputs:&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</p>

<blockquote>
<p>x&#160;&#160;&#160; y0&#160;&#160;&#160; count&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; w&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; y</p>

<p>4&#160;&#160;&#160;&#160; 2&#160;&#160;&#160;&#160;&#160; 6&#160;&#160;&#160;&#160;&#160; 2.2204E-15&#160;&#160;&#160; 2</p>
</blockquote>

<p>After 6 iterations, Newton-Raphson(also called <strong>divide-and-average</strong>) gets an approximated square root. See what happed during each iteration compared the output generated by SAS function,sqrt():</p>

<blockquote>
<p><font face="Courier New">data root; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; x=4;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; y0=1;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; count=0; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; do until (w<1e-8);&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; count=count+1;&#160;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; y=(y0+x/y0)/2;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; w=abs(y-y0); <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; y0=y; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if y =sqrt(x) then is_eq_sqrt=&ldquo;YES&rdquo;; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; else is_eq_sqrt=&ldquo;NO&rdquo;; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; output; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; end; <br />run;</font></p>
</blockquote>

<p>Outputs:</p>

<blockquote>
<p>x&#160;&#160;&#160;&#160;&#160;&#160; y0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; count&#160;&#160;&#160;&#160;&#160;&#160;&#160; w&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; y&#160;&#160;&#160;&#160; is_eq_sqrt</p>

<p>4&#160;&#160;&#160; 2.50000&#160;&#160;&#160;&#160;&#160; 1&#160;&#160;&#160;&#160;&#160; 1.50000&#160;&#160;&#160; 2.50000&#160;&#160;&#160;&#160; NO<br />
4&#160;&#160;&#160; 2.05000&#160;&#160;&#160;&#160;&#160; 2&#160;&#160;&#160;&#160;&#160; 0.45000&#160;&#160;&#160; 2.05000&#160;&#160;&#160;&#160; NO<br />
4&#160;&#160;&#160; 2.00061&#160;&#160;&#160;&#160;&#160; 3&#160;&#160;&#160;&#160;&#160; 0.04939&#160;&#160;&#160; 2.00061&#160;&#160;&#160;&#160; NO<br />
4&#160;&#160;&#160; 2.00000&#160;&#160;&#160;&#160;&#160; 4&#160;&#160;&#160;&#160;&#160; 0.00061&#160;&#160;&#160; 2.00000&#160;&#160;&#160;&#160; NO<br />
4&#160;&#160;&#160; 2.00000&#160;&#160;&#160;&#160;&#160; 5&#160;&#160;&#160;&#160;&#160; 0.00000&#160;&#160;&#160; <font color="#ff0000">2.00000&#160;&#160;&#160;&#160; NO</font><br />
4&#160;&#160;&#160; 2.00000&#160;&#160;&#160;&#160;&#160; 6&#160;&#160;&#160;&#160;&#160; 0.00000&#160;&#160; <font color="#ff0000">2.00000</font>&#160;&#160;&#160;&#160; <font color="#ff0000">YES </font>&#160;&#160;&#160;&#160;</p>
</blockquote>

<p>What’s the difference between count 5 and 6 since their y values look the same? We reset the tolerance value to 1e-3 rather than 1e-8, and get the outputs:</p>

<blockquote>
<p>x&#160;&#160;&#160;&#160;&#160;&#160; y0&#160;&#160;&#160;&#160;&#160; count&#160;&#160;&#160;&#160;&#160;&#160; w&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; y&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; is_eq_sqrt</p>

<p>4&#160;&#160;&#160; 2.50000&#160;&#160;&#160;&#160;&#160; 1&#160;&#160;&#160;&#160;&#160; 1.50000&#160;&#160;&#160; 2.50000&#160;&#160;&#160;&#160;&#160; NO<br />
4&#160;&#160;&#160; 2.05000&#160;&#160;&#160;&#160;&#160; 2&#160;&#160;&#160;&#160;&#160; 0.45000&#160;&#160;&#160; 2.05000&#160;&#160;&#160;&#160;&#160; NO<br />
4&#160;&#160;&#160; 2.00061&#160;&#160;&#160;&#160;&#160; 3&#160;&#160;&#160;&#160;&#160; 0.04939&#160;&#160;&#160; 2.00061&#160;&#160;&#160;&#160;&#160; NO<br />
4&#160;&#160;&#160; 2.00000&#160;&#160;&#160;&#160;&#160; 4&#160;&#160;&#160;&#160;&#160; 0.00061&#160;&#160;&#160; 2.00000&#160;&#160;&#160;&#160;&#160; NO&#160;&#160;&#160;&#160;&#160;&#160;</p>
</blockquote>

<p>The system get a faster convergence at an higher error rate, with an approximated&#160; value little away from sqrt(4).</p>

<p>We should have a deep understanding of how SAS stores numeric values, which deserves a full session to discuss, to unearth the mystery. Some basic references:</p>

<ul>
<li><em><a href="http://support.sas.com/documentation/cdl/en/lrcon/62955/HTML/default/a000695157.htm">Numeric Precision in SAS Software</a></em></li>
<li><em><a href="http://support.sas.com/techsup/technote/ts654.pdf">Numeric Precision 101</a></em></li>
<li><em><a href="http://support.sas.com/techsup/technote/ts230.html">Dealing with Numeric Representation Error in SAS Applications</a></em></li>
</ul>

    </div>
  </article>

  


</main>

      <footer class="footer">
        <ul class="footer-links">
          <li>
            <a href="../../../../index.xml" type="application/rss+xml" target="_blank">RSS feed</a>
          </li>
          <li>
            <a href="https://gohugo.io/" class="footer-links-kudos">Made with <img src="../../../../images/hugo-logo.png" width="22" height="22"></a>
          </li>
        </ul>
      </footer>

    </div>
    

    

    
  </body>
</html>

